from unidecode import unidecode

# Unicode -> font mapping
UNICODE_MAP_NORMAL = {
    "Ø": 8,
    "ø": 9,
    "à": 11,
    "â": 12,
    "å": 14,
    "é": 15,
    "è": 16,
    "ö": 17,
    "ō": 18,
    "ü": 19,
    "í": 20,
    "ç": 21,
    "ñ": 22,
    "č": 23,
    "š": 24,
    "ž": 25,
    "Ö": 27,
    "Ü": 28,
    "Ñ": 29,
    "Ł": 30,
    "ł": 31,
    "•": 127,
}

# font -> bold mapping
BOLD_MAP = {
    8: 143,
    9: 143,
    11: 129,
    12: 129,
    14: 129,
    15: 133,
    16: 133,
    17: 143,
    18: 143,
    19: 149,
    20: 137,
    21: 131,
    22: 142,
    23: 131,
    24: 147,
    25: 154,
    27: 143,
    28: 149,
    29: 142,
    30: 140,
    31: 140,
    32: 32,
    33: 33,
    34: 34,
    35: 35,
    36: 36,
    37: 37,
    38: 128,
    39: 156,
    40: 157,
    41: 158,
    42: 42,
    43: 43,
    44: 159,
    45: 45,
    46: 160,
    47: 47,
    48: 1,
    49: 2,
    50: 3,
    51: 4,
    52: 5,
    53: 6,
    54: 7,
    55: 253,
    56: 254,
    57: 255,
    58: 155,
    59: 59,
    60: 60,
    61: 61,
    62: 62,
    63: 63,
    64: 64,
    65: 129,
    66: 130,
    67: 131,
    68: 132,
    69: 133,
    70: 134,
    71: 135,
    72: 136,
    73: 137,
    74: 138,
    75: 139,
    76: 140,
    77: 141,
    78: 142,
    79: 143,
    80: 144,
    81: 145,
    82: 146,
    83: 147,
    84: 148,
    85: 149,
    86: 150,
    87: 151,
    88: 152,
    89: 153,
    90: 154,
    91: 91,
    92: 92,
    93: 93,
    94: 94,
    95: 95,
    96: 96,
    97: 129,
    98: 130,
    99: 131,
    100: 132,
    101: 133,
    102: 134,
    103: 135,
    104: 136,
    105: 137,
    106: 138,
    107: 139,
    108: 140,
    109: 141,
    110: 142,
    111: 143,
    112: 144,
    113: 145,
    114: 146,
    115: 147,
    116: 148,
    117: 149,
    118: 150,
    119: 151,
    120: 152,
    121: 153,
    122: 154,
    123: 123,
    124: 124,
    125: 125,
    126: 126,
    127: 127
}

# font -> underline mapping
UNDERLINE_MAP = {
    8: 191,
    9: 192,
    11: 163,
    12: 165,
    14: 166,
    15: 167,
    16: 168,
    17: 171,
    18: 172,
    19: 189,
    20: 190,
    21: 193,
    22: 220,
    23: 221,
    24: 222,
    25: 223,
    27: 208,
    28: 214,
    29: 207,
    30: 252,
    31: 225,
    32: 161,
    33: 33,
    34: 163,
    35: 35,
    36: 36,
    37: 37,
    38: 38,
    39: 168,
    40: 169,
    41: 170,
    42: 42,
    43: 43,
    44: 173,
    45: 174,
    46: 175,
    47: 176,
    48: 177,
    49: 178,
    50: 179,
    51: 180,
    52: 181,
    53: 182,
    54: 183,
    55: 184,
    56: 185,
    57: 186,
    58: 187,
    59: 188,
    60: 60,
    61: 61,
    62: 62,
    63: 63,
    64: 64,
    65: 194,
    66: 195,
    67: 196,
    68: 197,
    69: 198,
    70: 199,
    71: 200,
    72: 201,
    73: 202,
    74: 203,
    75: 204,
    76: 205,
    77: 206,
    78: 207,
    79: 208,
    80: 209,
    81: 210,
    82: 211,
    83: 212,
    84: 213,
    85: 214,
    86: 215,
    87: 216,
    88: 217,
    89: 218,
    90: 219,
    91: 91,
    92: 92,
    93: 93,
    94: 94,
    95: 224,
    96: 96,
    97: 226,
    98: 227,
    99: 228,
    100: 229,
    101: 230,
    102: 231,
    103: 232,
    104: 233,
    105: 234,
    106: 235,
    107: 236,
    108: 237,
    109: 238,
    110: 239,
    111: 240,
    112: 241,
    113: 242,
    114: 243,
    115: 244,
    116: 245,
    117: 246,
    118: 247,
    119: 248,
    120: 249,
    121: 250,
    122: 251,
    123: 123,
    124: 124,
    125: 125,
    126: 126,
    127: 127,
}

def decode_bytes(text: str) -> bytes:
    output = bytearray()

    for ch in text:
        mapped = UNICODE_MAP_NORMAL.get(ch)
        if mapped is not None:
            if isinstance(mapped, int):
                output.append(mapped)
            else:  # bytes
                output.extend(mapped)
        else:
            # unidecode may return multiple ASCII characters
            ascii_fallback = unidecode(ch)
            output.extend(ascii_fallback.encode("ascii", "replace"))

    return bytes(output)
    
def to_bold(text: bytes) -> bytes:
    output = bytearray()
    
    for ch in text:
        mapped = BOLD_MAP.get(ch)
        if mapped is not None:
            output.append(mapped)
        else:
            output.append(ch)

    return bytes(output)
    
def to_underline(text: bytes) -> bytes:
    output = bytearray()
    
    for ch in text:
        mapped = UNDERLINE_MAP.get(ch)
        if mapped is not None:
            output.append(mapped)
        else:
            output.append(ch)
            
    return bytes(output)
